<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
        }

        #note-content {
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 100px;
            white-space: pre-wrap;
            background: black;
            color: white;
            font-family: monospace;
            line-height: 1.5;
        }

        .file-input {
            display: none;
        }

        .custom-file-upload {
            display: inline-block;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #ffffff00;
            color: white;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #ccc; /* Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ */
        }

        .custom-file-upload:hover {
            background-color: #a1121200;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .emoji-button {
            cursor: pointer;
            padding: 5px;
            font-size: 24px;
        }

        .visibility-toggle {
            margin-top: 20px;
            color: white;
        }

        .reminder {
            margin-top: 20px;
            color: white;
        }
    </style>
</head>

<body>
    <h1>Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸</h1>
    <form id="note-form" onsubmit="saveNote(); return false;">
        <input type="text" id="note-title" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸" required>
        <div id="note-content" contenteditable="true" required></div>

        <button type="button" onclick="openModal()">ğŸ˜€</button>

        <input type="file" id="image-input" class="file-input" accept="image/*" onchange="addImageToText(this)">
        <label for="image-input" class="custom-file-upload">ğŸ“·</label>

        <input type="file" id="video-input" class="file-input" accept="video/*" onchange="addVideoToText(this)">
        <label for="video-input" class="custom-file-upload">ğŸ¥</label>

        <div class="visibility-toggle">
            <label>
                <input type="checkbox" id="visibility-checkbox"> ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°
            </label>
        </div>

        <div class="reminder">
            <label for="reminder-time">ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ:</label>
            <input type="datetime-local" id="reminder-time">
        </div>

        <button type="submit">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ—Ğ°Ğ¼ĞµÑ‚ĞºÑƒ</button>
    </form>
    <button onclick="location.href='index.html'">ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°Ğ¼</button>

    <div id="emojiModal" class="modal">
        <div class="modal-content">
            <span onclick="closeModal()" style="cursor: pointer; float: right;">&times;</span>
            <div id="emoji-container">
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜€')">ğŸ˜€</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜€')">ğŸ˜€</span>
                <span class="emoji-button" onclick="insertEmoji('â¤ï¸')">â¤ï¸</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜ƒ')">ğŸ˜ƒ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜„')">ğŸ˜„</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜†')">ğŸ˜†</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤£')">ğŸ¤£</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜…')">ğŸ˜…</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’•')">ğŸ’•</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜‡')">ğŸ˜‡</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ™‚')">ğŸ™‚</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ™ƒ')">ğŸ™ƒ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜‰')">ğŸ˜‰</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥°')">ğŸ¥°</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜˜')">ğŸ˜˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜—')">ğŸ˜—</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’“')">ğŸ’“</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜™')">ğŸ˜™</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜š')">ğŸ˜š</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜‹')">ğŸ˜‹</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜œ')">ğŸ˜œ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤ª')">ğŸ¤ª</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤¨')">ğŸ¤¨</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ§')">ğŸ§</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥³')">ğŸ¥³</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤©')">ğŸ¤©</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’˜')">ğŸ’˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜’')">ğŸ˜’</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜”')">ğŸ˜”</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜Ÿ')">ğŸ˜Ÿ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜•')">ğŸ˜•</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ™')">ğŸ™</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜£')">ğŸ˜£</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜–')">ğŸ˜–</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜«')">ğŸ˜«</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’”')">ğŸ’”</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜©')">ğŸ˜©</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥º')">ğŸ¥º</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜­')">ğŸ˜­</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¤')">ğŸ˜¤</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜ ')">ğŸ˜ </span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¡')">ğŸ˜¡</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤¬')">ğŸ¤¬</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜±')">ğŸ˜±</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¨')">ğŸ˜¨</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜°')">ğŸ˜°</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜·')">ğŸ˜·</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤’')">ğŸ¤’</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤•')">ğŸ¤•</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤¢')">ğŸ¤¢</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¤®')">ğŸ¤®</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜µ')">ğŸ˜µ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜³')">ğŸ˜³</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’œ')">ğŸ’œ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜±')">ğŸ˜±</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¨')">ğŸ˜¨</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜°')">ğŸ˜°</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜­')">ğŸ˜­</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜©')">ğŸ˜©</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥³')">ğŸ¥³</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ˜‡')">ğŸ˜‡</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ‘»')">ğŸ‘»</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ’€')">ğŸ’€</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ‘½')">ğŸ‘½</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ§™â€â™€ï¸')">ğŸ§™â€â™€ï¸</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¦„')">ğŸ¦„</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¯')">ğŸ¯</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¶')">ğŸ¶</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ±')">ğŸ±</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¦‹')">ğŸ¦‹</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ‰')">ğŸ‰</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŠ')">ğŸŠ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸˆ')">ğŸˆ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥‡')">ğŸ¥‡</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥ˆ')">ğŸ¥ˆ</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥‰')">ğŸ¥‰</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ†')">ğŸ†</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ…')">ğŸ…</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¥‚')">ğŸ¥‚</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ¾')">ğŸ¾</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ»')">ğŸ»</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ•')">ğŸ•</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸ”')">ğŸ”</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒ¹')">ğŸŒ¹</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒº')">ğŸŒº</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒ»')">ğŸŒ»</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒ¼')">ğŸŒ¼</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒ·')">ğŸŒ·</span>
                <span class="emoji-button" onclick="insertEmoji('ğŸŒˆ')">ğŸŒˆ</span>
                <span class="emoji-button" onclick="insertEmoji('â˜€ï¸')">â˜€ï¸</span>
                <!-- Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞ¼Ğ°Ğ¹Ğ»Ñ‹ Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ -->
            </div>
        </div>
    </div>

    <script>
        const editingIndex = localStorage.getItem('editingIndex');
        const notes = JSON.parse(localStorage.getItem('notes')) || [];
        const currentNickname = localStorage.getItem('nickname') || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚ĞµĞ½'; 

        document.addEventListener('DOMContentLoaded', function () {
            applySavedStyles();

            // Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
            if (editingIndex !== null) {
                const index = parseInt(editingIndex); // ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² Ñ‡Ğ¸ÑĞ»Ğ¾
                const note = notes[index];
                if (note) { // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°
                    document.getElementById('note-title').value = note.title;
                    document.getElementById('note-content').innerHTML = note.content;
                    document.getElementById('visibility-checkbox').checked = note.isPublic;
                    if (note.reminder) { // Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ
                        document.getElementById('reminder-time').value = note.reminder;
                    }
                }
            }

            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°
            document.getElementById('note-content').addEventListener('input', updateResult);
        });

        function applySavedStyles() {
            const savedBgColor = localStorage.getItem('bgColor');
            const savedTextColor = localStorage.getItem('textColor');

            if (savedBgColor) {
                document.body.style.backgroundColor = savedBgColor;
            }
            if (savedTextColor) {
                document.body.style.color = savedTextColor; 
                document.getElementById('note-content').style.color = savedTextColor; 
            }
        }
        
        function addImageToText(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imgTag = `<img src="${e.target.result}" style="max-width: 100%;" />`;
                    const noteContent = document.getElementById('note-content');
                    noteContent.innerHTML += imgTag;
                    noteContent.innerHTML += '<br>';
                };
                reader.readAsDataURL(file);
            }
        }

        function addVideoToText(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const videoTag = `<video controls style="max-width: 100%;" src="${e.target.result}"></video>`;
                    const noteContent = document.getElementById('note-content');
                    noteContent.innerHTML += videoTag;
                    noteContent.innerHTML += '<br>';
                };
                reader.readAsDataURL(file);
            }
        }

        function insertEmoji(emoji) {
            const noteContent = document.getElementById('note-content');
            noteContent.innerHTML += emoji;
            closeModal();
        }

        function saveNote() {
            const title = document.getElementById('note-title').value;
            const content = document.getElementById('note-content').innerHTML;
            const isPublic = document.getElementById('visibility-checkbox').checked;
            const reminder = document.getElementById('reminder-time').value; // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ

            // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
            if (editingIndex !== null) {
                const index = parseInt(editingIndex);
                if (notes[index]) { // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
                    notes[index] = { 
                        id: notes[index].id, 
                        title: title, 
                        content: content, 
                        author: currentNickname, 
                        isPublic: isPublic,
                        reminder: reminder // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ
                    };
                }
            } else {
                const noteId = Date.now();
                notes.push({ 
                    id: noteId, 
                    title: title, 
                    content: content, 
                    author: currentNickname, 
                    isPublic: isPublic,
                    reminder: reminder // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ
                });
            }

            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.removeItem('editingIndex');
            location.href = 'index.html';
        }

        function openModal() {
            document.getElementById('emojiModal').style.display = "block";
        }

        function closeModal() {
            document.getElementById('emojiModal').style.display = "none";
        }

        window.onclick = function (event) {
            const modal = document.getElementById('emojiModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function updateResult() {
            const contentElement = document.getElementById('note-content');
            const content = contentElement.innerHTML;
            const lastLine = content.split('<br>').pop().trim().replace(/<[^>]*>/g, '');

            if (lastLine.endsWith('=')) {
                const expression = lastLine.slice(0, -1).trim();
                try {
                    const result = eval(expression);
                    const updatedContent = content.replace(lastLine, `${expression}=${result}`);
                    
                    // Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
                    const selection = window.getSelection();
                    const range = selection.getRangeAt(0);
                    
                    // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
                    const lastLineNode = range.startContainer;
                    const lastLineText = lastLineNode.textContent;
                    lastLineNode.textContent = lastLineText.slice(0, lastLineText.length - lastLine.length);
                    
                    // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
                    const resultNode = document.createTextNode(` ${expression}=${result}\n`); // Ğ˜Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ <br> Ğ² ĞºĞ¾Ğ½Ñ†Ğµ
                    lastLineNode.parentNode.insertBefore(resultNode, lastLineNode.nextSibling);
                    
                    // Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºÑƒÑ€ÑĞ¾Ñ€ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
                    range.setStartAfter(resultNode);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } catch (error) {
                    // Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ
                }
            }
        }
    </script>
</body>

</html>

